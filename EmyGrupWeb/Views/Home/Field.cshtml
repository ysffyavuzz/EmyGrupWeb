@{
    ViewData["Title"] = "Sahada Biz";
}
@inject Microsoft.Extensions.Localization.IStringLocalizer<SharedResource> L

<style>
    .spacer-section {
        margin-top: 120px;
    }

    @@media (max-width: 768px) {
        .spacer-section {
            margin-top: 90px;
        }
    }

    /* ── Başlık ── */
    .catalog-title {
        font-size: 2.4rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 3px;
        font-family: 'Helvetica Neue', 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(180deg, #2b2b2b 0%, #000 100%);
        -webkit-background-clip: text;
        color: transparent;
        filter: drop-shadow(0 2px 5px rgba(0,0,0,0.15));
        margin-bottom: 14px;
        opacity: 0;
        transform: translateY(10px);
        animation: catTitleIn .65s ease forwards;
    }

    .catalog-title-line {
        width: 260px;
        height: 3px;
        margin: 0 auto;
        border-radius: 8px;
        background: linear-gradient(90deg, rgba(0,0,0,0), rgba(0,0,0,0.55), rgba(0,0,0,0));
        transform: scaleX(.86);
        opacity: 0;
        animation: catLineIn .75s ease forwards;
        animation-delay: .1s;
        transform-origin: center;
    }

    @@keyframes catTitleIn {
        to { opacity: 1; transform: translateY(0); }
    }
    @@keyframes catLineIn {
        to { opacity: .45; transform: scaleX(1); }
    }

    /* ── Masonry Gallery ── */
    .masonry-gallery {
        columns: 4;
        column-gap: 14px;
        margin-top: 8px;
    }

    .gallery-item {
        break-inside: avoid;
        margin-bottom: 14px;
        border-radius: 14px;
        overflow: hidden;
        cursor: pointer;
        position: relative;
        background: #e2e8f0;
        min-height: 160px;
        /* giriş animasyonu */
        opacity: 0;
        transform: translateY(10px);
        transition:
            opacity .3s ease var(--d, 0ms),
            transform .3s cubic-bezier(.2,.8,.2,1) var(--d, 0ms);
    }

    .gallery-item.is-visible {
        opacity: 1;
        transform: translateY(0);
    }

    .gallery-item img {
        width: 100%;
        height: auto;
        display: block;
        transition: transform .4s cubic-bezier(.2,.8,.2,1);
    }

    /* Hover overlay */
    .gallery-item::after {
        content: '';
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0);
        transition: background .3s ease;
        pointer-events: none;
    }

    .gallery-item:hover::after {
        background: rgba(0, 0, 0, 0.22);
    }

    .gallery-item:hover img {
        transform: scale(1.04);
    }

    /* Responsive columns */
    @@media (max-width: 1200px) {
        .masonry-gallery { columns: 3; }
    }
    @@media (max-width: 768px) {
        .masonry-gallery { columns: 2; column-gap: 10px; }
        .gallery-item { margin-bottom: 10px; border-radius: 10px; }
    }
    @@media (max-width: 480px) {
        .masonry-gallery { columns: 2; column-gap: 8px; }
        .gallery-item { margin-bottom: 8px; border-radius: 8px; }
    }

    /* ── Lightbox ── */
    .field-lightbox {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.94);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        padding: 20px;
    }

    .field-lightbox.open {
        display: flex;
    }

    .lightbox-content {
        position: relative;
        max-width: 90vw;
        max-height: 92vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .lightbox-content img {
        max-width: 88vw;
        max-height: 88vh;
        object-fit: contain;
        border-radius: 14px;
        box-shadow: 0 24px 80px rgba(0, 0, 0, 0.6);
        display: block;
    }

    .lightbox-close {
        position: fixed;
        top: 20px;
        right: 24px;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.15);
        border: none;
        color: #fff;
        font-size: 1.4rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background .2s;
        z-index: 10000;
    }

    .lightbox-close:hover { background: rgba(255,255,255,0.28); }

    .lightbox-counter {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%);
        color: rgba(255,255,255,0.7);
        font-size: 0.875rem;
        font-weight: 500;
        letter-spacing: .05em;
        z-index: 10000;
    }

    .lightbox-nav {
        position: fixed;
        top: 50%;
        transform: translateY(-50%);
        width: 52px;
        height: 52px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.15);
        border: none;
        color: #fff;
        font-size: 1.3rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background .2s;
        z-index: 10000;
    }

    .lightbox-nav:hover { background: rgba(255,255,255,0.28); }
    .lightbox-prev { left: 20px; }
    .lightbox-next { right: 20px; }

    @@media (max-width: 768px) {
        .lightbox-prev { left: 8px; }
        .lightbox-next { right: 8px; }
        .lightbox-nav { width: 42px; height: 42px; font-size: 1.1rem; }
    }

    /* Reduce motion */
    @@media (prefers-reduced-motion: reduce) {
        .catalog-title, .catalog-title-line { animation: none; opacity: 1; transform: none; }
        .gallery-item { opacity: 1; transform: none; transition: none; }
    }
</style>

<section class="spacer-section">
    <div class="container py-5">

        <!-- Başlık -->
        <div class="catalog-title-wrapper text-center mb-5">
            <h2 class="catalog-title">@L["Side_Menu_SahadaBiz"]</h2>
            <div class="catalog-title-line"></div>
        </div>

        <!-- Masonry Gallery -->
        <div class="masonry-gallery" id="masonryGallery">
            @for (int i = 1; i <= 76; i++)
            {
                int imgIndex = i;
                if (i == 21) imgIndex = 28;
                else if (i == 28) imgIndex = 21;

                string loadMode = i <= 20 ? "eager" : "lazy";
                string decodeMode = i <= 20 ? "sync" : "async";

                <div class="gallery-item" data-index="@(i - 1)">
                    <img src="/images/saha2/galeri/@(imgIndex).jpeg"
                         alt="Saha Görseli @i"
                         loading="@loadMode"
                         decoding="@decodeMode" />
                </div>
            }
        </div>

    </div>
</section>

<!-- Lightbox -->
<div class="field-lightbox" id="fieldLightbox">
    <button class="lightbox-close" id="lightboxClose"><i class="bi bi-x-lg"></i></button>
    <button class="lightbox-nav lightbox-prev" id="lightboxPrev"><i class="bi bi-chevron-left"></i></button>
    <div class="lightbox-content">
        <img id="lightboxImg" src="" alt="Büyük Görsel" />
    </div>
    <button class="lightbox-nav lightbox-next" id="lightboxNext"><i class="bi bi-chevron-right"></i></button>
    <div class="lightbox-counter" id="lightboxCounter"></div>
</div>

<script>
(function () {
    const gallery   = document.getElementById('masonryGallery');
    const items     = Array.from(gallery.querySelectorAll('.gallery-item'));
    const lightbox  = document.getElementById('fieldLightbox');
    const lbImg     = document.getElementById('lightboxImg');
    const lbClose   = document.getElementById('lightboxClose');
    const lbPrev    = document.getElementById('lightboxPrev');
    const lbNext    = document.getElementById('lightboxNext');
    const lbCounter = document.getElementById('lightboxCounter');
    const total     = items.length;
    let current     = 0;

    /* ── stagger delay & immediate reveal for first viewport ── */
    items.forEach((el, i) => {
        if (i < 16) {
            // İlk 16 öğe: kısa stagger, hemen göster
            el.style.setProperty('--d', (i * 25) + 'ms');
            el.classList.add('is-visible');
        } else {
            el.style.setProperty('--d', '0ms');
        }
    });

    /* ── intersection observer ── */
    const io = new IntersectionObserver(entries => {
        entries.forEach(e => {
            if (e.isIntersecting) {
                e.target.classList.add('is-visible');
                io.unobserve(e.target);
            }
        });
    }, { threshold: 0.05, rootMargin: '200px 0px 200px 0px' });

    items.forEach((el, i) => { if (i >= 16) io.observe(el); });

    /* ── lightbox helpers ── */
    function openLightbox(idx) {
        current = idx;
        lbImg.src = items[idx].querySelector('img').src;
        lbCounter.textContent = (idx + 1) + ' / ' + total;
        lightbox.classList.add('open');
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
        lightbox.classList.remove('open');
        document.body.style.overflow = '';
    }

    function navigate(dir) {
        current = (current + dir + total) % total;
        lbImg.src = items[current].querySelector('img').src;
        lbCounter.textContent = (current + 1) + ' / ' + total;
    }

    /* ── events ── */
    items.forEach((el, idx) => el.addEventListener('click', () => openLightbox(idx)));

    lbClose.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', e => { if (e.target === lightbox) closeLightbox(); });

    lbPrev.addEventListener('click', e => { e.stopPropagation(); navigate(-1); });
    lbNext.addEventListener('click', e => { e.stopPropagation(); navigate(1); });

    document.addEventListener('keydown', e => {
        if (!lightbox.classList.contains('open')) return;
        if (e.key === 'Escape')      closeLightbox();
        if (e.key === 'ArrowRight')  navigate(1);
        if (e.key === 'ArrowLeft')   navigate(-1);
    });

    /* ── touch swipe for lightbox ── */
    let tx = 0;
    lightbox.addEventListener('touchstart', e => { tx = e.changedTouches[0].screenX; }, { passive: true });
    lightbox.addEventListener('touchend', e => {
        const diff = tx - e.changedTouches[0].screenX;
        if (Math.abs(diff) > 50) navigate(diff > 0 ? 1 : -1);
    }, { passive: true });
})();
</script>
